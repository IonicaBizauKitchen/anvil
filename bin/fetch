#!/bin/bash

# fail fast
set -o errexit
set -o pipefail

id=$1

echo() {
  /bin/echo "$1" "$2"
}

error() {
  /bin/echo $*; exit 1
}

# get root dir
root_dir=$(pwd)

# create a temporary compile directory
compile_dir=$(mktemp -t compile_XXXXX)
rm -rf $compile_dir
mkdir -p $compile_dir

# fetching app
case $1 in
  *.json)
    manifest=$(mktemp -t manifest_XXXXX)
    curl -s $1 -o $manifest
    $root_dir/bin/download_manifest $manifest $compile_dir >/dev/null
    ;;
  *.git)
    git clone "$1" "$compile_dir" --recursive --depth 1 >/dev/null 2>/dev/null
    ;;
  *)
    error "Unknown source type: $1"
    ;;
esac

manifest=$(mktemp -t manifest_XXXXX)

echo $compile_dir
